{% extends "base.html" %}
{% block content %}

<div class="metrics">
    <div class="metric">
        <div class="metric-value" id="matched-count">{{ events|length }}</div>
        <div class="metric-label">Matched Events</div>
    </div>
    <div class="metric">
        <div class="metric-value arb-positive" id="arb-count">{{ opportunities|length }}</div>
        <div class="metric-label">Active Arbs</div>
    </div>
    <div class="metric">
        <div class="metric-value">
            {% if opportunities %}
                {{ "%.2f"|format(opportunities[0].get('roi_after_fees', 0) if opportunities[0] is mapping else 0) }}%
            {% else %}
                --
            {% endif %}
        </div>
        <div class="metric-label">Best ROI</div>
    </div>
    <div class="metric">
        <div class="metric-value">{{ poly_count }}</div>
        <div class="metric-label">Poly Markets</div>
    </div>
    <div class="metric">
        <div class="metric-value">{{ kalshi_count }}</div>
        <div class="metric-label">Kalshi Markets</div>
    </div>
    <div class="metric">
        <div class="metric-value">{{ "%.1f"|format(last_scan_duration) }}s</div>
        <div class="metric-label">Scan Time</div>
    </div>
</div>

<div class="sport-filters">
    <a href="/" class="filter-btn {{ 'active' if not current_sport else '' }}">All</a>
    {% for sport in available_sports %}
        <a href="/?sport={{ sport }}" class="filter-btn {{ 'active' if current_sport == sport else '' }}">{{ sport|upper }}</a>
    {% endfor %}
</div>

<div class="grid">
    <div class="card" id="alerts-panel"
         hx-get="/partials/alerts"
         hx-trigger="sse:update"
         hx-swap="innerHTML">
        <h2>Arbitrage Opportunities</h2>
        {% include "partials/alerts.html" %}
    </div>

    <div class="card" id="events-panel"
         hx-get="/partials/events?sport={{ current_sport }}&amp;min_roi={{ current_min_roi }}"
         hx-trigger="sse:update"
         hx-swap="innerHTML">
        <h2>Matched Events</h2>
        <div class="roi-filters">
            <a href="/?sport={{ current_sport }}&min_roi=-5"
               class="roi-btn {{ 'active' if current_min_roi == '-5' or current_min_roi is not defined else '' }}">ROI &gt; -5%</a>
            <a href="/?sport={{ current_sport }}&min_roi=0"
               class="roi-btn {{ 'active' if current_min_roi == '0' else '' }}">Profitable</a>
            <a href="/?sport={{ current_sport }}&min_roi=all"
               class="roi-btn {{ 'active' if current_min_roi == 'all' else '' }}">All</a>
        </div>
        {% include "partials/events.html" %}
    </div>
</div>

{% endblock %}
